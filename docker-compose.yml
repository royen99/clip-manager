version: '3.8'

services:
  clip-manager:
    build: .
    container_name: clip-manager
    ports:
      - "3080:3000"
    volumes:
      # Persist uploads and database using named volumes
      - clip-uploads:/app/uploads
      - clip-data:/app/data
    environment:
      - PORT=3000
      - UPLOAD_DIR=/app/uploads
      - DB_PATH=/app/data/database.db
      - MAX_FILE_SIZE=104857600
      - MODERATION_THRESHOLD=0.7
      - TAG_CONFIDENCE_THRESHOLD=0.5
      - OLLAMA_HOST=http://192.168.1.22:11434
      - OLLAMA_MODEL=llava
      - ENABLE_AUTO_TAGGING=true
      - ENABLE_CONTENT_MODERATION=true
    restart: unless-stopped
    networks:
      - clip-network

volumes:
  clip-uploads:
  clip-data:

networks:
  clip-network:
    driver: bridge
